<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>SVVFD Admin Panel</title>
</head>
<body class="admin-body">
    <nav class="admin-nav" style="padding: 20px 0;">
        <div class="admin-nav-content" style="max-width: 1400px; margin: 0 auto;">
            <a href="{{ url_for('index') }}" style="display: inline-block; padding: 10px 20px; background: rgba(255,255,255,0.2); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; margin-bottom: 20px; transition: all 0.3s;">‚Üê Back to Home</a>

            <div style="margin-bottom: 30px;">
                <h1 style="margin: 0;">SVVFD Admin Panel</h1>
            </div>

            <!-- Export Controls Grid -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; background: rgba(255,255,255,0.1); padding: 25px; border-radius: 12px;">

                <!-- Payroll Export Section -->
                <div>
                    <h3 style="color: #fff; margin: 0 0 15px 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">üìä</span> PAYROLL EXPORT
                    </h3>
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 12px;">
                        <select id="payroll_month" style="padding: 8px 12px; border-radius: 6px; border: none; font-size: 14px; flex: 1; min-width: 120px;">
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                        <select id="payroll_year" style="padding: 8px 12px; border-radius: 6px; border: none; font-size: 14px; width: 100px;">
                            {% for y in range(2020, 2031) %}
                                <option value="{{ y }}" {% if y == 2025 %}selected{% endif %}>{{ y }}</option>
                            {% endfor %}
                        </select>
                        <button onclick="exportPayroll('csv', true)" style="padding: 8px 16px; background: #1976d2; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px; white-space: nowrap;">
                            üìÑ CSV
                        </button>
                        <button onclick="exportPayroll('pdf', true)" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px; white-space: nowrap;">
                            üìï PDF
                        </button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button onclick="exportPayroll('csv', false)" style="padding: 10px; background: #f5f5f5; color: #1a237e; border: 2px solid #1a237e; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">
                            üìÑ Export All (CSV)
                        </button>
                        <button onclick="exportPayroll('pdf', false)" style="padding: 10px; background: #f5f5f5; color: #dc3545; border: 2px solid #dc3545; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">
                            üìï Export All (PDF)
                        </button>
                    </div>
                </div>

                <!-- Vehicle Inspection Export Section -->
                <div>
                    <h3 style="color: #fff; margin: 0 0 15px 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">üöí</span> VEHICLE INSPECTION EXPORT
                    </h3>
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 12px;">
                        <select id="insp_month" style="padding: 8px 12px; border-radius: 6px; border: none; font-size: 14px; flex: 1; min-width: 120px;">
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                        <select id="insp_year" style="padding: 8px 12px; border-radius: 6px; border: none; font-size: 14px; width: 100px;">
                            {% for y in range(2020, 2031) %}
                                <option value="{{ y }}" {% if y == 2025 %}selected{% endif %}>{{ y }}</option>
                            {% endfor %}
                        </select>
                        <button onclick="exportInspections('csv', true)" style="padding: 8px 16px; background: #20c997; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px; white-space: nowrap;">
                            üìÑ CSV
                        </button>
                        <button onclick="exportInspections('pdf', true)" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px; white-space: nowrap;">
                            üìï PDF
                        </button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button onclick="exportInspections('csv', false)" style="padding: 10px; background: #f5f5f5; color: #20c997; border: 2px solid #20c997; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">
                            üìÑ Export All (CSV)
                        </button>
                        <button onclick="exportInspections('pdf', false)" style="padding: 10px; background: #f5f5f5; color: #dc3545; border: 2px solid #dc3545; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">
                            üìï Export All (PDF)
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </nav>

    <!-- Management Tools Section - Right under blue header -->
    <div style="max-width: 1400px; margin: 0 auto; padding: 0 20px;">
        <div style="background: rgba(255,255,255,0.9); padding: 25px; border-radius: 12px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            <h2 style="color: #333; margin: 0 0 20px 0; font-size: 20px; text-align: center; font-weight: 600;">üìã Management & Tools</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <a href="{{ url_for('dashboard') }}" style="display: block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-decoration: none; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'">
                    <div style="font-size: 32px; margin-bottom: 10px;">üìä</div>
                    <div style="font-weight: 600; font-size: 16px;">Dashboard</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">Statistics & analytics</div>
                </a>
                <a href="{{ url_for('inspections_menu') }}" style="display: block; background: white; color: #333; padding: 20px; border-radius: 10px; text-decoration: none; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'">
                    <div style="font-size: 32px; margin-bottom: 10px;">üîç</div>
                    <div style="font-weight: 600; font-size: 16px;">Vehicle Inspections</div>
                    <div style="font-size: 13px; color: #666; margin-top: 5px;">6-day inspection tracking</div>
                </a>
                <a href="{{ url_for('manage_checklist') }}" style="display: block; background: white; color: #333; padding: 20px; border-radius: 10px; text-decoration: none; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'">
                    <div style="font-size: 32px; margin-bottom: 10px;">üìã</div>
                    <div style="font-weight: 600; font-size: 16px;">Manage Checklist</div>
                    <div style="font-size: 13px; color: #666; margin-top: 5px;">Add/edit inspection items</div>
                </a>
                <a href="{{ url_for('maintenance_menu') }}" style="display: block; background: white; color: #333; padding: 20px; border-radius: 10px; text-decoration: none; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'">
                    <div style="font-size: 32px; margin-bottom: 10px;">üîß</div>
                    <div style="font-weight: 600; font-size: 16px;">Maintenance</div>
                    <div style="font-size: 13px; color: #666; margin-top: 5px;">Work orders & repairs</div>
                </a>
                <a href="{{ url_for('manage_vehicles') }}" style="display: block; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 20px; border-radius: 10px; text-decoration: none; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'">
                    <div style="font-size: 32px; margin-bottom: 10px;">üöõ</div>
                    <div style="font-weight: 600; font-size: 16px;">Fleet Management</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">Add & manage vehicles</div>
                </a>
                <a href="{{ url_for('inventory_menu') }}" style="display: block; background: white; color: #333; padding: 20px; border-radius: 10px; text-decoration: none; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'">
                    <div style="font-size: 32px; margin-bottom: 10px;">üì¶</div>
                    <div style="font-weight: 600; font-size: 16px;">Inventory</div>
                    <div style="font-size: 13px; color: #666; margin-top: 5px;">Equipment & supplies</div>
                </a>
                <a href="{{ url_for('reports_menu') }}" style="display: block; background: white; color: #333; padding: 20px; border-radius: 10px; text-decoration: none; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'">
                    <div style="font-size: 32px; margin-bottom: 10px;">üìä</div>
                    <div style="font-weight: 600; font-size: 16px;">Reports</div>
                    <div style="font-size: 13px; color: #666; margin-top: 5px;">Generate & export reports</div>
                </a>
                <a href="{{ url_for('alerts_dashboard') }}" style="display: block; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); color: white; padding: 20px; border-radius: 10px; text-decoration: none; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'">
                    <div style="font-size: 32px; margin-bottom: 10px;">üö®</div>
                    <div style="font-weight: 600; font-size: 16px;">Alerts Dashboard</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">Warnings & notifications</div>
                </a>
                <a href="{{ url_for('manage_stations') }}" style="display: block; background: white; color: #333; padding: 20px; border-radius: 10px; text-decoration: none; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'">
                    <div style="font-size: 32px; margin-bottom: 10px;">üè¢</div>
                    <div style="font-weight: 600; font-size: 16px;">Manage Stations</div>
                    <div style="font-size: 13px; color: #666; margin-top: 5px;">Add fire station locations</div>
                </a>
                <a href="{{ url_for('manage_checklist_items') }}" style="display: block; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 10px; text-decoration: none; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'">
                    <div style="font-size: 32px; margin-bottom: 10px;">üìã</div>
                    <div style="font-weight: 600; font-size: 16px;">Manage Checklist Items</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">Configure inspection checks</div>
                </a>
            </div>
        </div>
    </div>

    <div class="admin-container">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="flash-message">
                    {{ messages[0] }}
                </div>
            {% endif %}
        {% endwith %}

        <div class="admin-grid">
            <!-- Left Column - Firefighter Overview -->
            <div class="admin-card firefighter-overview">
                <h2>Firefighter Overview</h2>
                <div class="table-responsive">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Number</th>
                                <th>Name</th>
                                <th>Hours</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for fireman_number, details in user_data.items() %}
                            <tr>
                                <td>{{ fireman_number }}</td>
                                <td>{{ details['full_name'] }}</td>
                                <td>{{ (details['hours'] | default(0)) | round(2) }}</td>
                                <td>
                                    <button class="action-button" onclick="showLogs('{{ fireman_number }}')">View Logs</button>
                                    <button class="action-button" onclick="showEditForm('{{ fireman_number }}')">Edit</button>
                                    <button class="delete-button action-button" onclick="showDeleteConfirmation('{{ fireman_number }}', '{{ details['full_name'] }}')">Delete</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Right Column - Forms and Controls -->
            <div class="admin-controls">
                <!-- Update Hours Form -->
                <div class="admin-card">
                    <h3>Update Hours</h3>
                    <form method="POST" action="{{ url_for('update_hours') }}" class="admin-form">
                        <div class="form-group">
                            <label for="fireman_number">Firefighter:</label>
                            <select name="fireman_number" id="fireman_number" required>
                                {% for fireman_number, details in user_data.items() %}
                                    <option value="{{ fireman_number }}">{{ details['full_name'] }} ({{ fireman_number }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="activity">Activity:</label>
                            <select name="activity" id="activity" required>
                                {% for category in categories %}
                                    <option value="{{ category }}">{{ category }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="log_date">Date:</label>
                            <input type="date" name="log_date" id="log_date" required>
                        </div>
                        <div class="form-group">
                            <label for="time_in">Time In:</label>
                            <input type="time" name="time_in" id="time_in" required>
                        </div>
                        <div class="form-group">
                            <label for="time_out">Time Out:</label>
                            <input type="time" name="time_out" id="time_out" required>
                        </div>
                        <button type="submit" class="submit-button">Update Hours</button>
                    </form>
                </div>

                <!-- Category Management -->
                <div class="admin-card">
                    <h3>Category Management</h3>
                    <div class="category-controls">
                        <form method="POST" action="{{ url_for('add_category') }}" class="admin-form">
                            <div class="form-group">
                                <label for="new_category">Add Category:</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <input type="text" name="new_category" id="new_category" required style="flex: 1;">
                                    <button type="submit" class="action-button" style="background: #28a745; white-space: nowrap;">‚ûï Add Category</button>
                                </div>
                            </div>
                        </form>

                        <form method="POST" action="{{ url_for('remove_category') }}" class="admin-form" onsubmit="return confirmCategoryRemoval()">
                            <div class="form-group">
                                <label for="category_to_remove">Remove Category:</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <select name="category_to_remove" id="category_to_remove" required style="flex: 1;">
                                        {% for category in categories %}
                                            <option value="{{ category }}">{{ category }}</option>
                                        {% endfor %}
                                    </select>
                                    <button type="submit" class="action-button delete-button" style="white-space: nowrap;">üóëÔ∏è Remove Category</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- System Management -->
                <div class="admin-card">
                    <h3>System Management</h3>
                    <div class="warning-section">
                        <button onclick="showClearLogsConfirmation()" class="danger-button">Clear All Logs</button>
                        <p class="warning-text-small">Warning: This will clear all hours and activity logs for all firefighters.</p>
                    </div>
                </div>
            </div>
        </div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
    <h3 style="margin: 0;">Activity Logs</h3>
    <button onclick="toggleActivityLogs()" class="action-button" id="toggleLogsBtn" style="background: #1976d2;">
        üìã Show Activity Logs
    </button>
</div>
<div id="activityLogsSection" style="display: none;">
    <p style="color: #666; margin-bottom: 15px; font-size: 14px;">
        <em>Showing logs sorted by most recent first. Today's logs appear at the top.</em>
    </p>
    <div class="table-responsive">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Firefighter</th>
                    <th>Activity</th>
                    <th>Time In</th>
                    <th>Time Out</th>
                    <th>Hours</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% if all_logs %}
                    {% for entry in all_logs %}
                        {% set log = entry['log'] %}
                        <tr>
                        <td>
                            {% if log['time_in'] %}
                                {% set time_in_obj = log['time_in']|fromisoformat %}
                                {{ time_in_obj.strftime('%m/%d/%Y') }}
                            {% else %}
                                --
                            {% endif %}
                        </td>
                        <td>{{ entry['full_name'] }}</td>
                        <td>{{ log['type'] }}</td>
                        <td>{{ log['time_in']|format_log_time }}</td>
                        <td>
                            {% if log['time_out'] %}
                                {{ log['time_out']|format_log_time }}
                            {% else %}
                                <span style="color: #dc3545;">Still Active</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if log['manual_added_hours'] %}
                                {{ log['manual_added_hours']|round(2) }}
                            {% elif log['time_out'] %}
                                {% set time_in = log['time_in']|fromisoformat %}
                                {% set time_out = log['time_out']|fromisoformat %}
                                {{ ((time_out - time_in).total_seconds() / 3600)|round(2) }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            <form action="{{ url_for('delete_log') }}" method="post" style="display: inline;"
                                  onsubmit="return confirm('Are you sure you want to delete this log entry?');">
                                <input type="hidden" name="log_id" value="{{ log['id'] }}">
                                <button type="submit" class="action-button delete-button">
                                    Delete Log
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                            No activity logs found.
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

        <!-- Modals -->
        <!-- Edit Modal -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Edit Firefighter</h2>
                <form method="POST" action="{{ url_for('edit_firefighter') }}" class="admin-form">
                    <input type="hidden" name="fireman_number" id="edit_fireman_number">
                    <div class="form-group">
                        <label for="full_name">Full Name:</label>
                        <input type="text" name="full_name" id="edit_full_name" required>
                    </div>
                    <div class="form-group">
                        <label for="new_fireman_number">Firefighter Number:</label>
                        <input type="text" name="new_fireman_number" id="edit_new_fireman_number" required>
                    </div>
                    <button type="submit" class="submit-button">Save Changes</button>
                </form>
            </div>
        </div>

        <!-- Logs Modal -->
        <div id="logsModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Activity Logs</h2>
                <div id="logsContent"></div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Delete Firefighter</h2>
                <div id="deleteConfirmationMessage"></div>
                <form method="POST" action="{{ url_for('delete_firefighter') }}" class="admin-form" id="deleteForm">
                    <input type="hidden" name="fireman_number" id="delete_fireman_number">
                    <div class="form-group">
                        <p class="warning-text">This action cannot be undone. All logs and hours for this firefighter will be permanently deleted.</p>
                        <div class="button-group">
                            <button type="submit" class="delete-button">Confirm Delete</button>
                            <button type="button" class="cancel-button" onclick="closeDeleteModal()">Cancel</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Clear Logs Modal -->
        <div id="clearLogsModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Clear All Logs</h2>
                <div class="warning-box">
                    <p class="warning-text">‚ö†Ô∏è WARNING: This action cannot be undone!</p>
                    <p>This will:</p>
                    <ul>
                        <li>Delete ALL activity logs for ALL firefighters</li>
                        <li>Reset ALL hour counts to zero</li>
                        <li>Keep firefighter registrations intact</li>
                    </ul>
                </div>
                <form method="POST" action="{{ url_for('clear_all_logs') }}" class="admin-form">
                    <div class="button-group">
                        <button type="submit" class="danger-button">Yes, Clear All Logs</button>
                        <button type="button" class="cancel-button" onclick="closeClearLogsModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Logout Button at Bottom -->
        <div style="text-align: center; margin: 40px 0 20px 0;">
            <a href="{{ url_for('logout') }}" class="logout-button" style="display: inline-block; padding: 14px 40px; font-size: 16px; border-radius: 8px; text-decoration: none;">
                Logout
            </a>
        </div>
    </div>

    <script>
        // Show logs modal
        function showLogs(firemanNumber) {
            const modal = document.getElementById('logsModal');
            const content = document.getElementById('logsContent');
            const userData = {{ user_data|tojson|safe }};
            const logs = userData[firemanNumber].logs;

            let logsHtml = `<h3>${userData[firemanNumber].full_name}'s Logs</h3>
                           <table class="admin-table">
                               <thead>
                                   <tr>
                                       <th>Activity</th>
                                       <th>Time In</th>
                                       <th>Time Out</th>
                                       <th>Hours</th>
                                   </tr>
                               </thead>
                               <tbody>`;

            logs.forEach(log => {
                logsHtml += `<tr>
                    <td>${log.type}</td>
                    <td>${formatDateTime(log.time_in)}</td>
                    <td>${log.time_out ? formatDateTime(log.time_out) : 'Still Clocked In'}</td>
                    <td>${log.manual_added_hours || 'N/A'}</td>
                </tr>`;
            });

            logsHtml += '</tbody></table>';
            content.innerHTML = logsHtml;
            modal.style.display = 'block';
        }

        // Show edit modal
        function showEditForm(firemanNumber) {
            const modal = document.getElementById('editModal');
            const userData = {{ user_data|tojson|safe }};

            document.getElementById('edit_fireman_number').value = firemanNumber;
            document.getElementById('edit_full_name').value = userData[firemanNumber].full_name;
            document.getElementById('edit_new_fireman_number').value = firemanNumber;

            modal.style.display = 'block';
        }

        // Show delete confirmation
        function showDeleteConfirmation(firemanNumber, fullName) {
            const modal = document.getElementById('deleteModal');
            const message = document.getElementById('deleteConfirmationMessage');
            const input = document.getElementById('delete_fireman_number');

            message.innerHTML = `<p>Are you sure you want to delete firefighter ${fullName} (${firemanNumber})?</p>`;
            input.value = firemanNumber;

            modal.style.display = 'block';
        }

        // Close delete modal
        function closeDeleteModal() {
            const modal = document.getElementById('deleteModal');
            modal.style.display = 'none';
        }

        // Show clear logs confirmation
        function showClearLogsConfirmation() {
            const modal = document.getElementById('clearLogsModal');
            modal.style.display = 'block';
        }

        // Close clear logs modal
        function closeClearLogsModal() {
            const modal = document.getElementById('clearLogsModal');
            modal.style.display = 'none';
        }

        // Format datetime
        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString();
        }

        // Close modals when clicking on X or outside
        document.querySelectorAll('.close').forEach(closeBtn => {
            closeBtn.onclick = function() {
                this.closest('.modal').style.display = 'none';
            }
        });

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>

<script>
function showLogs(fireman_number) {
    fetch(`/get_firefighter_logs/${fireman_number}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
                return;
            }

            const logsContent = document.getElementById('logsContent');
            let html = `<h3 style="color: #1a237e; margin-bottom: 1.5rem;">${data.name}'s Activity Logs</h3>
                       <div class="table-responsive">
                         <table class="admin-table">
                             <thead>
                                 <tr>
                                     <th>Activity</th>
                                     <th>Time In</th>
                                     <th>Time Out</th>
                                     <th>Hours</th>
                                 </tr>
                             </thead>
                             <tbody>`;

            data.logs.forEach(log => {
                html += `<tr>
                          <td>${log.type}</td>
                          <td>${log.time_in}</td>
                          <td>${log.time_out}</td>
                          <td>${log.hours}</td>
                        </tr>`;
            });

            html += '</tbody></table></div>';
            logsContent.innerHTML = html;

            const modal = document.getElementById('logsModal');
            modal.style.display = 'block';
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while loading the logs.');
        });
}

// Close modal when clicking the √ó button
document.querySelector('#logsModal .close').onclick = function() {
    document.getElementById('logsModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('logsModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}

// Toggle activity logs visibility
function toggleActivityLogs() {
    const logsSection = document.getElementById('activityLogsSection');
    const toggleBtn = document.getElementById('toggleLogsBtn');

    if (logsSection.style.display === 'none') {
        logsSection.style.display = 'block';
        toggleBtn.textContent = 'üìã Hide Activity Logs';
        toggleBtn.style.background = '#dc3545';
    } else {
        logsSection.style.display = 'none';
        toggleBtn.textContent = 'üìã Show Activity Logs';
        toggleBtn.style.background = '#1976d2';
    }
}

// Confirm category removal
function confirmCategoryRemoval() {
    const category = document.getElementById('category_to_remove').value;
    return confirm(`‚ö†Ô∏è Are you sure you want to remove the "${category}" category?\n\nNote: This may affect existing time logs that use this category.`);
}

// Export payroll data
function exportPayroll(format, useMonthYear) {
    let url = format === 'pdf' ? '/export_data_pdf' : '/export_data';
    if (useMonthYear) {
        const month = document.getElementById('payroll_month').value;
        const year = document.getElementById('payroll_year').value;
        url += `?month=${month}&year=${year}`;
    }
    window.location.href = url;
}

// Export inspection data
function exportInspections(format, useMonthYear) {
    let url = format === 'pdf' ? '/export_inspections_pdf' : '/export_inspections';
    if (useMonthYear) {
        const month = document.getElementById('insp_month').value;
        const year = document.getElementById('insp_year').value;
        url += `?month=${month}&year=${year}`;
    }
    window.location.href = url;
}
</script>

<!-- Small footer promo -->
<div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.1); margin-top: 40px; font-size: 11px; color: #666;">
    <span style="opacity: 0.7;">üí° Tip: Display live updates on TV with</span>
    <a href="{{ url_for('alerts_dashboard') }}" style="color: #1976d2; text-decoration: none; font-weight: 500;">SignPresenter</a>
    <span style="opacity: 0.5;">|</span>
    <a href="{{ url_for('display') }}" style="color: #666; text-decoration: none;">View Display</a>
</div>

</body>
</html>